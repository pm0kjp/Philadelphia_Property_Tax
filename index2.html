<!DOCTYPE html>
<html>
<head>
<style type="text/css">
	#chart_div{
  height:900px;
}
</style>
<title>Worst 2015 Philadelphia Tax Delinquents</title>
  
<!-- THIS IS CRITICAL -->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<!-- end of really critical bit -->

  
</head>
<body>
<div id="chart_div"></div> 
<script>

// Load the Visualization API and the corechart package.
  google.charts.load('current', {'packages':['bar']});

  // Set a callback to run when the Google Visualization API is loaded.
  google.charts.setOnLoadCallback(drawSheetName);

  // This function does All The Things.

  function drawSheetName() {
  
    // Set up my query statement for my Google Spreadsheet, which I've 
    // already prepared in a prior step.  Tell which columns I want -- A, B, and C--
    // as well as how many rows.  I chose 50, because more than that starts to be 
    // overwhelming.
   
    var queryString = encodeURIComponent('SELECT A, B, C LIMIT 50 ');

    // Prepare the actual query
    var query = new google.visualization.Query(
    
    // I got the link below from the "Share" button on my Google Sheet.
  'https://docs.google.com/spreadsheets/d/1m_r_KC2js6xkHndqqGfWzrkgUW4RvgDTti9tUKhVQ0k/gviz/tq?sheet=Sheet1&headers=1&tq=' + queryString);
    
    // Send the query!  When a response comes back, send it to 
    // handleSampleDataQueryResponse.  I could have also called that response
    // function anything else, like BananaSplitsAreTasty, but I tried to name
    // it something that would help me know what it actually does.
   
    query.send(handleSampleDataQueryResponse);
  }

  function handleSampleDataQueryResponse(response) {
    
    // in case an error comes back, please tell us!
    if (response.isError()) {
      alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
      return;
    }
    
    // if there's no error, get the data out of the response.
    var data = response.getDataTable();
    
    // set up the way I want money to be displayed.
    var formatter = new google.visualization.NumberFormat({pattern: '$#,###,###.00'});
    // Apply formatter to second column -- we start counting at 0.
    formatter.format(data, 1); 
  
  // set up some look-and-feel parameters
    
  var options = {
      width: 1200,
      height:800,
      chart: {
        title: 'Worst (in Amount Owed) Philadelphia 2015 Property Tax Delinquents',
        subtitle: 'Amount Owed and Number of Delinquent Properties'
      },
    bars: 'horizontal', // Required for Material Bar Charts with 2 axes in one dimension
    series: {
      0: { axis: 'TotalOwed' },  // first axis in x dimension
      1: { axis: 'NumProperties' } // second axis in the x dimension
    },
    axes: {
        x: {
        TotalOwed: {label: 'Amount Owed, USD', side: "top", format:"currency"}, // Bottom x-axis.
        NumProperties: {label: 'Number of Properties'} //Top x-axis.
      }
    }
  };

  // I'm all set up, so draw it, and please draw it in the "chart_div" spot
  // I set up in my html.

  var chart = new google.charts.Bar(document.getElementById('chart_div'));
  chart.draw(data, options);
  }
 </script>
</body>
</html>
